"use strict";angular.module("cardistry",["ui.router","firebase","cardistry.cards","cardistry.main"]).config(["$stateProvider","$urlRouterProvider",function(a,e){a.state("login",{url:"/",templateUrl:"app/partials/login.html",controller:"loginPageCtrl as login"}).state("home",{url:"/home",templateUrl:"app/partials/home.html",controller:"MainCtrl as app"}).state("player",{url:"/player",templateUrl:"app/partials/player.html",controller:"PlayerCtrl as players"}).state("czar",{url:"/czar",templateUrl:"app/partials/czar.html",controller:"PlayerCtrl as players"}).state("about",{url:"/about",templateUrl:"app/partials/about.html"}),e.otherwise("/")}]),angular.module("cardistry.main",["cardistry.cards","firebase"]).constant("CONFIG",{Firebase:{baseUrl:"https://cardistry.firebaseio.com/gameDB"}}).controller("MainCtrl",["$firebase","Auth","$filter","Deck",function(a,e,r,t){var i=this;e.onAuth(function(a){i.user=a}),this.scoreSet=function(){i.user.dailyScore=0,i.user.weeklyScore=0,i.user.totalScore=0},this.dealIn=function(){t.load().then(t.shuffle).then(function(a){i.user.deck=a,i.user.hand=t.nextWhite(i.user.deck.white,10),i.scoreSet(),i.user.$save()})},this.getCard=function(a){console.log(i.user.hand),i.user.hand=i.user.hand.concat(t.nextWhite(this.user.deck.white,a)),i.user.$save()}}]).controller("PlayerCtrl",["$filter","Auth","Deck","FirebaseUrl","$firebase",function(a,e,r,t,i){var n=this;e.onAuth(function(a){n.user=a}),console.log(n.user);var l=t.child("players"),s=i(l),o=t.child("cardCzar"),c=i(o);this.hand=n.user.hand,this.cardIndex=0,this.chosenCard=c.$asArray(),this.playersObj=s.$asObject(),console.log(this.playersObj),this.next=function(){n.cardIndex>=n.user.hand.length-1?this.cardIndex=0:this.cardIndex++},this.prev=function(){n.cardIndex<=0?this.cardIndex=9:this.cardIndex--},this.playCard=function(a){n.chosenCard.$add({question:n.user.deck.black[0].text,answer:a.text,user:n.user.$id});var e=n.user.hand.indexOf(a);n.user.hand.splice(e,1),n.user.deck.black.splice(0,1),n.user.hand=n.user.hand.concat(r.nextWhite(this.user.deck.white,1)),n.user.$save()},n.user.czarIndex=0,this.funny=function(a){this.playersObj[a].dailyScore++,this.playersObj.$save(),this.next()},this.notFunny=function(){this.next()}}]).controller("loginPageCtrl",["Auth",function(a){this.logIn=a.logIn,this.logOut=a.logOut}]).factory("FirebaseUrl",["CONFIG",function(a){return new Firebase(a.Firebase.baseUrl)}]).factory("Auth",["FirebaseUrl","$firebaseAuth","$firebase","$filter",function(a,e,r){function t(e){if(null===e)return null;var t=a.child("players").child(e.facebook.id);t.update({uid:e.uid,facebook:e.facebook,fullName:e.facebook.displayName,firstName:e.facebook.cachedUserProfile.first_name,avatarUrl:e.facebook.cachedUserProfile.picture.data.url});var t=r(a.child("players").child(e.facebook.id)).$asObject();return t}var i=e(a);return{onAuth:function(a){i.$onAuth(function(e){a(t(e))})},logIn:function(){return i.$authWithOAuthPopup("facebook")},logOut:function(){i.$unauth()}}}]),angular.module("cardistry.cards",[]).factory("Deck",["$http",function(a){var e={load:function(){return a.get("/assets/data/cards.JSON").then(function(a){e.cards={},e.cards.white=[],e.cards.black=[];for(var r=a.data,t=0;t<r.length;t++)"A"===r[t].cardType?e.cards.white[r[t].id]={text:r[t].text,priority:0,expansion:r[t].expansion}:"Q"===r[t].cardType&&1===r[t].numAnswers&&(e.cards.black[r[t].id]={text:r[t].text,priority:0,expansion:r[t].expansion})})},shuffle:function(){return angular.forEach(e.cards.white,function(a){a.priority=Math.floor(Math.random()*(Object.keys(e.cards.white).length-1)+1)}),angular.forEach(e.cards.black,function(a){a.priority=Math.floor(Math.random()*(Object.keys(e.cards.black).length-1)+1)}),angular.forEach(e.cards,function(a){a.sort(function(a,e){return e.priority-a.priority})}),e.cards},nextWhite:function(a,e){var r=a.splice(0,e);return r},nextBlack:function(){}};return e}]),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/about.html",'<div class="allabout"><div id="explaination"><h2>So... what is<br>Cards Against Singularity, anyway?</h2><br><h3>Well, start reading because we ain\'t doing it for ya!</h3><br><p>Who doesn\'t love Cards Against Humanity? We\'ll tell you who... the Introverts!<br><br></p><p>We just want to unite with other <span id="horrible">HORRIBLE</span> people but separately, in the safety of our own homes. Now we can, with Cards Against Singularity!</p><br></div><h3 class="rules">How To Play</h3><br><ol><li>Sign in via Facebook</li><br><li>Pick your Poison: Player or Czar.</li><br><li>As Player, you will view question cards and submit your best answer card from your hand... just waiting to be judged by others. No pressure though.</li><br><li>As Czar, you will view a collection of question/answer card pairs submitted by your fellow introverts and judge their humor. Funny? That player gets an awesome point. Not funny? Shoot them down and hope they cry</li></ol></div><ul><li class="back"><a ui-sref="home">Back</a></li></ul>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/account-page.html",'<div class="account"><section id="accountInfo"><img id="profilePic" src="{{app.user.avatarUrl}}"> <span id="greeting">Yo, Ari</span> <button ng-show="app.user.hand.length !== 10" id="deal" ng-click="app.dealIn()">Deal Me In!</button> <button id="newCard" ng-click="app.getCard()">Gimme</button><ul id="scoreboard"><li>Daily Score: {{app.user.dailyScore}}</li><li>Weekly Score: {{app.user.weeklyScore}}</li><li>Total Score: {{app.user.totalScore}}</li></ul></section><ul id="gameChoices"><li class="bottom-left" id="cardCzar"><a ui-sref="czar">CZAR</a></li><li class="bottom-right" id="playerSelect"><a ui-sref="player">PLAYER</a></li></ul></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/czar.html",'<div id="player" ng-repeat="card in players.chosenCard" ng-show="players.cardIndex == $index"><ul id="questions"><li><section id="question" class="top"><h3>{{card.question}}</h3></section></li></ul><div class="buttons"><p><span ng-click="players.funny(card.user)" class="fa fa-thumbs-up thumbs"></span></p><p><span ng-click="players.notFunny()" class="fa fa-thumbs-down thumbs"></span></p></div><h3 id="answer"><div id="ansWrap"><ul id="answerCards" class="bottom img-fulid"><li id="{{$index}}">{{card.answer}}</li></ul></div><span ui-sref="home" class="fa fa-home fa-2x home"></span></h3></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/home.html",'<div class="account"><section id="accountInfo"><img id="profilePic" src="{{app.user.avatarUrl}}"> <span id="greeting">Yo, Ari</span> <button ng-show="app.user.hand.length !== 10" id="deal" ng-click="app.dealIn()">Deal Me In!</button> <button id="newCard" ng-click="app.getCard()">Gimme</button><ul id="scoreboard"><li>Daily Score: {{app.user.dailyScore}}</li><li>Weekly Score: {{app.user.weeklyScore}}</li><li>Total Score: {{app.user.totalScore}}</li></ul></section><ul id="gameChoices"><li class="bottom-left" id="cardCzar"><a ui-sref="czar">CZAR</a></li><li class="bottom-right" id="playerSelect"><a ui-sref="player">PLAYER</a></li></ul></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/login.html",'<div class="auth"><ul><li class="top"><p>Cards Against Singularity</p></li><li class="about"><a ui-sref="about">About</a></li><li class="bottom"><a ng-click="login.logIn()" ui-sref="home">SIGN IN</a></li></ul></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/player.html",'<div id="player"><ul id="questions"><li><section id="question" class="top" ng-repeat="question in players.user.deck.black"><h3>{{question.text}}</h3></section></li></ul><div class="buttons"><p><span ng-click="players.next()" class="fa fa-arrow-right right"></span></p><p><span ng-click="players.prev()" class="fa fa-arrow-left left"></span></p></div><h3 id="answer"><div id="ansWrap"><ul id="answerCards" class="bottom img-fulid"><li ng-repeat="card in players.user.hand" ng-show="players.cardIndex == $index">{{card.text}} <button class="submit" ng-click="players.playCard(card)"><span id="btn">Play</span></button></li></ul></div><span ui-sref="home" class="fa fa-home fa-2x home"></span></h3></div>')}])}();