"use strict";angular.module("cardistry",["ui.router","firebase","cardistry.cards","cardistry.main","angular-gestures"]).config(["$stateProvider","$urlRouterProvider",function(a,e){a.state("login",{url:"/",templateUrl:"app/partials/login.html",controller:"loginPageCtrl as login"}).state("home",{url:"/home",templateUrl:"app/partials/home.html",controller:"MainCtrl as app"}).state("player",{url:"/player",templateUrl:"app/partials/player.html",controller:"PlayerCtrl as players"}).state("czar",{url:"/czar",templateUrl:"app/partials/czar.html",controller:"PlayerCtrl as players"}).state("about",{url:"/about",templateUrl:"app/partials/about.html"}),e.otherwise("/")}]),angular.module("cardistry.main",["cardistry.cards","firebase","angular-gestures"]).constant("CONFIG",{Firebase:{baseUrl:"https://cardistry.firebaseio.com/gameDB"}}).controller("MainCtrl",["$firebase","Auth","$filter","Deck",function(a,e,r,t){var i=this;e.onAuth(function(a){i.user=a}),this.scoreSet=function(){i.user.dailyScore=0,i.user.weeklyScore=0,i.user.totalScore=0},this.dealIn=function(){t.load().then(t.shuffle).then(function(a){i.user.deck=a,i.user.hand=t.nextWhite(i.user.deck.white,10),i.scoreSet(),i.user.$save()})},this.getCard=function(a){console.log(i.user.hand),i.user.hand=i.user.hand.concat(t.nextWhite(this.user.deck.white,a)),i.user.$save()}}]).controller("PlayerCtrl",["$filter","Auth","Deck","FirebaseUrl","$firebase",function(a,e,r,t,i){var s=this;e.onAuth(function(a){s.user=a}),console.log(s.user);var l=t.child("players"),n=i(l),o=t.child("cardCzar"),c=i(o);this.hand=s.user.hand,this.cardIndex=0,this.chosenCard=c.$asArray(),this.chosenCardObj=c.$asObject(),this.playersObj=n.$asObject(),console.log(this.playersObj),this.next=function(){s.cardIndex>=s.user.hand.length-1?this.cardIndex=0:this.cardIndex++},this.czarIndex=0,s.chosenCard.$loaded().then(function(){s.czarIndex=s.chosenCard.length-1}),this.prev=function(){s.cardIndex<=0?this.cardIndex=9:this.cardIndex--},this.playCard=function(a){s.chosenCard.$add({question:s.user.deck.black[0].text,answer:a.text,user:s.user.$id,points:0});var e=s.user.hand.indexOf(a);s.user.hand.splice(e,1),s.user.deck.black.splice(0,1),s.user.hand=s.user.hand.concat(r.nextWhite(this.user.deck.white,1)),s.user.$save()},this.funny=function(a,e){this.chosenCardObj[this.chosenCard[e].$id].points++,this.chosenCardObj.$save(),this.playersObj[a].dailyScore++,this.playersObj.$save(),s.czarIndex--},this.notFunny=function(){s.czarIndex--}}]).controller("loginPageCtrl",["Auth",function(a){this.logIn=a.logIn,this.logOut=a.logOut}]).factory("FirebaseUrl",["CONFIG",function(a){return new Firebase(a.Firebase.baseUrl)}]).factory("Auth",["FirebaseUrl","$firebaseAuth","$firebase","$filter",function(a,e,r){function t(e){if(null===e)return null;var t=a.child("players").child(e.facebook.id);t.update({uid:e.uid,facebook:e.facebook,fullName:e.facebook.displayName,firstName:e.facebook.cachedUserProfile.first_name,avatarUrl:e.facebook.cachedUserProfile.picture.data.url});var t=r(a.child("players").child(e.facebook.id)).$asObject();return t}var i=e(a);return{onAuth:function(a){i.$onAuth(function(e){a(t(e))})},logIn:function(){return i.$authWithOAuthPopup("facebook")},logOut:function(){i.$unauth()}}}]),angular.module("cardistry.cards",[]).factory("Deck",["$http",function(a){var e={load:function(){return a.get("/assets/data/cards.JSON").then(function(a){e.cards={},e.cards.white=[],e.cards.black=[];for(var r=a.data,t=0;t<r.length;t++)"A"===r[t].cardType?e.cards.white[r[t].id]={text:r[t].text,priority:0,expansion:r[t].expansion}:"Q"===r[t].cardType&&1===r[t].numAnswers&&(e.cards.black[r[t].id]={text:r[t].text,priority:0,expansion:r[t].expansion})})},shuffle:function(){return angular.forEach(e.cards.white,function(a){a.priority=Math.floor(Math.random()*(Object.keys(e.cards.white).length-1)+1)}),angular.forEach(e.cards.black,function(a){a.priority=Math.floor(Math.random()*(Object.keys(e.cards.black).length-1)+1)}),angular.forEach(e.cards,function(a){a.sort(function(a,e){return e.priority-a.priority})}),e.cards},nextWhite:function(a,e){var r=a.splice(0,e);return r},nextBlack:function(){}};return e}]),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/about.html",'<div class="allabout"><div id="explaination"><h2>So... what is<br>Cards Against Singularity, anyway?</h2><br><h3>Well, start reading because we ain\'t doing it for ya!</h3><br><p>Who doesn\'t love Cards Against Humanity? We\'ll tell you who... the Introverts!<br><br></p><p>We just want to unite with other <span id="horrible">HORRIBLE</span> people but separately, in the safety of our own homes. Now we can, with Cards Against Singularity!</p><br></div><h3 class="rules">How To Play</h3><br><ol><li>Sign in via Facebook</li><br><li>Pick your Poison: Player or Czar.</li><br><li>As Player, you will view question cards and submit your best answer card from your hand... just waiting to be judged by others. No pressure though.</li><br><li>As Czar, you will view a collection of question/answer card pairs submitted by your fellow introverts and judge their humor. Funny? That player gets an awesome point. Not funny? Shoot them down and hope they cry</li></ol></div><ul><li class="back"><a ui-sref="home">Back</a></li></ul>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/confirmationModal.html",'<div id="modal" ng-controller="PlayerCtrl as players"><script type="text/ng-template"><div class="modal-header"> <h3 class="modal-title">Play This Card?</h3> </div> <div class="modal-body"> <ul> <li ng-repeat="question in players.user.deck.black"> {{question.text}} </li> <li ng-repeat="card in players.user.hand" ng-show="players.cardIndex == $index"> {{card.text}} </li> </ul> </div> <div class="modal-footer"> <button class="btn btn-primary" ng-click="players.PlayCard()">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button> </div></script></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/czar.html",'<div id="player" ng-repeat="card in players.chosenCard" ng-show="players.czarIndex == $index"><ul id="questions"><li><section id="question" class="top"><h3>{{card.question}}</h3></section></li></ul><div class="controls"><div class="buttons"><p><span class="fa fa-thumbs-up thumbs"></span></p><p><span class="fa fa-thumbs-down thumbs"></span></p></div><div class="prev" hm-tap="players.notFunny()"></div><div class="next" hm-tap="players.funny(card.user, $index)"></div></div><h3 class="answer"><div class="ansWrap"><ul class="bottom img-fulid answerCards" id="czarAnswer"><li id="{{$index}}">{{card.answer}}</li></ul></div><div class="back" id="pBack"><a ui-sref="home">Back</a></div></h3></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/home.html",'<div class="account"><section id="accountInfo"><img id="profilePic" src="{{app.user.avatarUrl}}"> <span id="greeting">Yo, {{app.user.firstName}}</span> <button ng-show="app.user.hand.length !== 10" id="deal" ng-click="app.dealIn()">Deal Me In!</button><ul id="scoreboard"><li>Daily Score: {{app.user.dailyScore}}</li><li>Weekly Score: {{app.user.weeklyScore}}</li><li>Total Score: {{app.user.totalScore}}</li></ul></section><ul id="gameChoices"><li class="bottom-left" id="cardCzar"><a ui-sref="czar">CZAR</a></li><li class="bottom-right" id="playerSelect"><a ui-sref="player">PLAYER</a></li></ul></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/lobby.html",'<div id="lobby" class="containr"><h1>Game Lobby</h1><ul class="col-md-4"><li><h1><a ui-sref="lobby.players">Players</a></h1></li><li><h1><a ui-sref="lobby.rules">Game Rules</a></h1></li><li><h1><a ui-sref="lobby.invite">Invite Friends</a></h1></li><li><h1><a ng-click="app.syncUp()">Start!</a></h1></li></ul><div class="col-md-8" ui-view=""></div></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/login.html",'<div class="auth"><ul><li class="top"><p>Cards Against Singularity</p></li><li class="about"><a ui-sref="about">About</a></li><li class="bottom"><a ng-click="login.logIn()" ui-sref="home">SIGN IN</a></li></ul></div>')}])}(),function(a){try{a=angular.module("cardistry")}catch(e){a=angular.module("cardistry",[])}a.run(["$templateCache",function(a){a.put("app/partials/player.html",'<div id="player"><ul id="questions"><li><section id="question" class="top" ng-repeat="question in players.user.deck.black"><h3>{{question.text}}</h3></section></li></ul><h3 class="answer"><div class="ansWrap"><ul class="bottom img-fulid answerCards"><div class="controls"><div class="prev" hm-tap="players.prev()"></div><div class="next" hm-tap="players.next()"></div></div><li ng-repeat="card in players.user.hand" ng-show="players.cardIndex == $index">{{card.text}}<div id="playCard" hm-tap="players.playCard(card)"></div></li></ul><div class="back" id="pBack"><a ui-sref="home">Back</a></div></div></h3></div>')}])}();